<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>4.4</version>
    <date>2020-08-24T06:47:26Z</date>
    <groups>
        <group>
            <name>Templates</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>Template Logstash</template>
            <name>Template Logstash</name>
            <description>Check Logstash status and LLD pipelines.&#13;
Check JVM memory.&#13;
Check pipelines events.&#13;
Check stages events metrics.</description>
            <groups>
                <group>
                    <name>Templates</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>Logstash</name>
                </application>
                <application>
                    <name>Logstash events</name>
                </application>
                <application>
                    <name>Logstash JVM</name>
                </application>
                <application>
                    <name>Logstash pipelines</name>
                </application>
                <application>
                    <name>Logstash process</name>
                </application>
                <application>
                    <name>Logstash raw data</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>Logstash events duration</name>
                    <type>DEPENDENT</type>
                    <key>logstash.events.duration_in_millis</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>s</units>
                    <applications>
                        <application>
                            <name>Logstash events</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.events.duration_in_millis</params>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>0.001</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.events</key>
                    </master_item>
                </item>
                <item>
                    <name>Logstash events filtered</name>
                    <type>DEPENDENT</type>
                    <key>logstash.events.filtered</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>Logstash events</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.events.filtered</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.events</key>
                    </master_item>
                </item>
                <item>
                    <name>Logstash events in</name>
                    <type>DEPENDENT</type>
                    <key>logstash.events.in</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>Logstash events</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.events.in</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.events</key>
                    </master_item>
                </item>
                <item>
                    <name>Logstash events filtered from input</name>
                    <type>CALCULATED</type>
                    <key>logstash.events.in.filtered</key>
                    <params>last(&quot;logstash.events.in&quot;) - last(&quot;logstash.events.filtered&quot;)</params>
                    <description>Logstash events input - events filtered</description>
                    <applications>
                        <application>
                            <name>Logstash events</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Logstash events out from input</name>
                    <type>CALCULATED</type>
                    <key>logstash.events.in.out</key>
                    <params>last(&quot;logstash.events.in&quot;) - last(&quot;logstash.events.out&quot;)</params>
                    <description>Logstash events input - events out</description>
                    <applications>
                        <application>
                            <name>Logstash events</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Logstash events in per min</name>
                    <type>DEPENDENT</type>
                    <key>logstash.events.in.pm</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>epm</units>
                    <applications>
                        <application>
                            <name>Logstash events</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.events.in</params>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <params/>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>60</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.events</key>
                    </master_item>
                </item>
                <item>
                    <name>Logstash events out</name>
                    <type>DEPENDENT</type>
                    <key>logstash.events.out</key>
                    <delay>0</delay>
                    <applications>
                        <application>
                            <name>Logstash events</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.events.out</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.events</key>
                    </master_item>
                </item>
                <item>
                    <name>Logstash events queue push duration</name>
                    <type>DEPENDENT</type>
                    <key>logstash.events.queue_push_duration_in_millis</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>s</units>
                    <applications>
                        <application>
                            <name>Logstash events</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.events.queue_push_duration_in_millis</params>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>0.001</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.events</key>
                    </master_item>
                </item>
                <item>
                    <name>Logstash heap max</name>
                    <type>DEPENDENT</type>
                    <key>logstash.heap_max_in_bytes</key>
                    <delay>0</delay>
                    <units>b</units>
                    <applications>
                        <application>
                            <name>Logstash JVM</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.jvm.mem.heap_max_in_bytes</params>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>10800</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.jvm</key>
                    </master_item>
                </item>
                <item>
                    <name>Logstash heap used</name>
                    <type>DEPENDENT</type>
                    <key>logstash.heap_used_in_bytes</key>
                    <delay>0</delay>
                    <units>b</units>
                    <applications>
                        <application>
                            <name>Logstash JVM</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.jvm.mem.heap_used_in_bytes</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.jvm</key>
                    </master_item>
                </item>
                <item>
                    <name>Logstash heap used percent</name>
                    <type>DEPENDENT</type>
                    <key>logstash.heap_used_percent</key>
                    <delay>0</delay>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Logstash JVM</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.jvm.mem.heap_used_percent</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.jvm</key>
                    </master_item>
                </item>
                <item>
                    <name>Logstash CPU Average Load 1 Minute</name>
                    <type>DEPENDENT</type>
                    <key>logstash.process.cpu.load_avg.1m</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Logstash process</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.process.cpu.load_average.1m</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.process</key>
                    </master_item>
                </item>
                <item>
                    <name>Logstash CPU Average Load 5 Minutes</name>
                    <type>DEPENDENT</type>
                    <key>logstash.process.cpu.load_avg.5m</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Logstash process</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.process.cpu.load_average.5m</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.process</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{last()}&gt;{$LOGSTASH.LA5.MAX.WARN}</expression>
                            <name>Logstash load average is too high (over {$LOGSTASH.LA5.MAX.WARN} for 5m)</name>
                            <priority>WARNING</priority>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Logstash CPU Average Load 15 Minutes</name>
                    <type>DEPENDENT</type>
                    <key>logstash.process.cpu.load_avg.15m</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <applications>
                        <application>
                            <name>Logstash process</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.process.cpu.load_average.15m</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.process</key>
                    </master_item>
                </item>
                <item>
                    <name>Logstash CPU Usage</name>
                    <type>DEPENDENT</type>
                    <key>logstash.process.cpu.percent</key>
                    <delay>0</delay>
                    <units>%</units>
                    <applications>
                        <application>
                            <name>Logstash process</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.process.cpu.percent</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.process</key>
                    </master_item>
                </item>
                <item>
                    <name>Logstash stats raw</name>
                    <key>logstash.stats</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <description>Raw json data.</description>
                    <applications>
                        <application>
                            <name>Logstash raw data</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Logstash stats events raw</name>
                    <key>logstash.stats.events</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <description>Raw json data.</description>
                    <applications>
                        <application>
                            <name>Logstash raw data</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Logstash duration per event</name>
                    <type>CALCULATED</type>
                    <key>logstash.stats.events.dpere</key>
                    <value_type>FLOAT</value_type>
                    <params>last(&quot;logstash.events.duration_in_millis&quot;) / last(&quot;logstash.events.out&quot;)</params>
                    <description>Event duration = all duration / events out.</description>
                    <applications>
                        <application>
                            <name>Logstash events</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Logstash stats jvm raw</name>
                    <key>logstash.stats.jvm</key>
                    <delay>5m</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <description>Raw json data.</description>
                    <applications>
                        <application>
                            <name>Logstash raw data</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Logstash stats process raw</name>
                    <key>logstash.stats.process</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <description>Raw json data.</description>
                    <applications>
                        <application>
                            <name>Logstash raw data</name>
                        </application>
                    </applications>
                </item>
                <item>
                    <name>Logstash status</name>
                    <type>DEPENDENT</type>
                    <key>logstash.status</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>Logstash</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.status</params>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>24h</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.jvm</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{str(green)}=0</expression>
                            <name>Logstash state error</name>
                            <priority>AVERAGE</priority>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Logstash version</name>
                    <type>DEPENDENT</type>
                    <key>logstash.version</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>Logstash</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.version</params>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>24h</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>logstash.stats.jvm</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <expression>{diff()}=1</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>Logstash version has changed</name>
                            <priority>INFO</priority>
                            <description>Logstash version has changed. Possible reasons that logstash has been updated or replaced. Ack to close.</description>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>Logstash pipelines</name>
                    <key>logstash.pipelines.discovery</key>
                    <delay>1h</delay>
                    <lifetime>1d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>Logstash {#PIPELINE} events duration</name>
                            <type>DEPENDENT</type>
                            <key>logstash.events.duration_in_millis.[{#PIPELINE}]</key>
                            <delay>0</delay>
                            <value_type>FLOAT</value_type>
                            <units>s</units>
                            <applications>
                                <application>
                                    <name>Logstash pipelines</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].events.duration_in_millis</params>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <params>0.001</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Logstash {#PIPELINE} events filtered</name>
                            <type>DEPENDENT</type>
                            <key>logstash.events.filtered.[{#PIPELINE}]</key>
                            <delay>0</delay>
                            <applications>
                                <application>
                                    <name>Logstash pipelines</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].events.filtered</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Logstash {#PIPELINE} events in per min</name>
                            <type>DEPENDENT</type>
                            <key>logstash.events.in.pm[{#PIPELINE}]</key>
                            <delay>0</delay>
                            <value_type>FLOAT</value_type>
                            <units>epm</units>
                            <applications>
                                <application>
                                    <name>Logstash pipelines</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].events.in</params>
                                </step>
                                <step>
                                    <type>CHANGE_PER_SECOND</type>
                                    <params/>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <params>60</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Logstash {#PIPELINE} events in</name>
                            <type>DEPENDENT</type>
                            <key>logstash.events.in.[{#PIPELINE}]</key>
                            <delay>0</delay>
                            <applications>
                                <application>
                                    <name>Logstash pipelines</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].events.in</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Logstash {#PIPELINE} events out</name>
                            <type>DEPENDENT</type>
                            <key>logstash.events.out.[{#PIPELINE}]</key>
                            <delay>0</delay>
                            <applications>
                                <application>
                                    <name>Logstash pipelines</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].events.out</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Logstash {#PIPELINE} events queue push duration</name>
                            <type>DEPENDENT</type>
                            <key>logstash.events.queue_push_duration_in_millis.[{#PIPELINE}]</key>
                            <delay>0</delay>
                            <value_type>FLOAT</value_type>
                            <units>s</units>
                            <applications>
                                <application>
                                    <name>Logstash pipelines</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].events.queue_push_duration_in_millis</params>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <params>0.001</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Logstash pipeline [{#PIPELINE}] duration per event</name>
                            <type>CALCULATED</type>
                            <key>logstash.stats.events.dpere.[{#PIPELINE}]</key>
                            <params>last(&quot;logstash.events.duration_in_millis.[{#PIPELINE}]&quot;) / ( last(&quot;logstash.events.out.[{#PIPELINE}]&quot;) + 0.001)</params>
                            <description>Event duration = all duration / events out.</description>
                            <applications>
                                <application>
                                    <name>Logstash pipelines</name>
                                </application>
                            </applications>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>Logstash Events total and {#PIPELINE}</name>
                            <graph_items>
                                <graph_item>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Template Logstash</host>
                                        <key>logstash.events.in.pm</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template Logstash</host>
                                        <key>logstash.events.in.pm[{#PIPELINE}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                </discovery_rule>
                <discovery_rule>
                    <name>Logstash filters and outputs</name>
                    <key>logstash.pipelines.stages.discovery</key>
                    <delay>1h</delay>
                    <filter>
                        <evaltype>FORMULA</evaltype>
                        <formula>(A and B) or C</formula>
                        <conditions>
                            <condition>
                                <macro>{#PLUGIN}</macro>
                                <value>outputs</value>
                                <formulaid>C</formulaid>
                            </condition>
                            <condition>
                                <macro>{#PLUGIN}</macro>
                                <value>filters</value>
                                <formulaid>B</formulaid>
                            </condition>
                            <condition>
                                <macro>{#NAME}</macro>
                                <value>grok</value>
                                <operator>NOT_MATCHES_REGEX</operator>
                                <formulaid>A</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <lifetime>1d</lifetime>
                    <description>Discover stages:&#13;
filters (except grok)&#13;
outputs</description>
                    <item_prototypes>
                        <item_prototype>
                            <name>Pipeline: {#PIPELINE}, id: {#ID} events duration</name>
                            <type>DEPENDENT</type>
                            <key>logstash.events.duration[{#PIPELINE},{#PLUGIN},{#ID}]</key>
                            <delay>0</delay>
                            <units>s</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Logstash {#PLUGIN} {#NAME}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].plugins.[&quot;{#PLUGIN}&quot;][?(@.id == &quot;{#ID}&quot;)].events.duration_in_millis.first()</params>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <params>0.001</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Pipeline: {#PIPELINE}, id: {#ID} events out</name>
                            <type>DEPENDENT</type>
                            <key>logstash.events.out[{#PIPELINE},{#PLUGIN},{#ID}]</key>
                            <delay>0</delay>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Logstash {#PLUGIN} {#NAME}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].plugins.[&quot;{#PLUGIN}&quot;][?(@.id == &quot;{#ID}&quot;)].events.out.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                </discovery_rule>
                <discovery_rule>
                    <name>Logstash codecs</name>
                    <key>logstash.pipelines.stages.discovery[&quot;codecs&quot;]</key>
                    <delay>1h</delay>
                    <filter>
                        <conditions>
                            <condition>
                                <macro>{#PLUGIN}</macro>
                                <value>codecs</value>
                                <formulaid>A</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <lifetime>1d</lifetime>
                    <description>Discover stages:&#13;
codecs</description>
                    <item_prototypes>
                        <item_prototype>
                            <name>Pipeline: {#PIPELINE}, id: {#ID} decode duration</name>
                            <type>DEPENDENT</type>
                            <key>logstash.codecs.decode.duration[{#PIPELINE},{#PLUGIN},{#ID}]</key>
                            <delay>0</delay>
                            <units>s</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Logstash {#PLUGIN} {#NAME}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].plugins.[&quot;{#PLUGIN}&quot;][?(@.id == &quot;{#ID}&quot;)].decode.duration_in_millis.first()</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Pipeline: {#PIPELINE}, id: {#ID} decode out</name>
                            <type>DEPENDENT</type>
                            <key>logstash.codecs.decode.out[{#PIPELINE},{#PLUGIN},{#ID}]</key>
                            <delay>0</delay>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Logstash {#PLUGIN} {#NAME}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].plugins.[&quot;{#PLUGIN}&quot;][?(@.id == &quot;{#ID}&quot;)].decode.out.first()</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>1h</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                </discovery_rule>
                <discovery_rule>
                    <name>Logstash filters, grok</name>
                    <key>logstash.pipelines.stages.discovery[&quot;filters&quot;,grok]</key>
                    <delay>1h</delay>
                    <filter>
                        <evaltype>AND</evaltype>
                        <conditions>
                            <condition>
                                <macro>{#NAME}</macro>
                                <value>grok</value>
                                <formulaid>A</formulaid>
                            </condition>
                            <condition>
                                <macro>{#PLUGIN}</macro>
                                <value>filters</value>
                                <formulaid>B</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <lifetime>1d</lifetime>
                    <description>Discover stages:&#13;
filters, grok plugin</description>
                    <item_prototypes>
                        <item_prototype>
                            <name>Pipeline: {#PIPELINE}, id: {#ID} events duration</name>
                            <type>DEPENDENT</type>
                            <key>logstash.filters.grok.events.duration[{#PIPELINE},{#ID}]</key>
                            <delay>0</delay>
                            <units>s</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Logstash {#PLUGIN} {#NAME}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].plugins.[&quot;{#PLUGIN}&quot;][?(@.id == &quot;{#ID}&quot;)].events.duration_in_millis.first()</params>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <params>0.001</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Pipeline: {#PIPELINE}, id: {#ID} events failures</name>
                            <type>DEPENDENT</type>
                            <key>logstash.filters.grok.events.failures[{#PIPELINE},{#ID}]</key>
                            <delay>0</delay>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Logstash {#PLUGIN} {#NAME}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].plugins.[&quot;{#PLUGIN}&quot;][?(@.id == &quot;{#ID}&quot;)].failures.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{change()}&lt;&gt;0</expression>
                                    <name>Pipeline: {#PIPELINE}, id: {#ID} failures grow</name>
                                    <priority>INFO</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>Pipeline: {#PIPELINE}, id: {#ID} events matches</name>
                            <type>DEPENDENT</type>
                            <key>logstash.filters.grok.events.matches[{#PIPELINE},{#ID}]</key>
                            <delay>0</delay>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Logstash {#PLUGIN} {#NAME}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].plugins.[&quot;{#PLUGIN}&quot;][?(@.id == &quot;{#ID}&quot;)].matches.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Pipeline: {#PIPELINE}, id: {#ID} events out</name>
                            <type>DEPENDENT</type>
                            <key>logstash.filters.grok.events.out[{#PIPELINE},{#ID}]</key>
                            <delay>0</delay>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Logstash {#PLUGIN} {#NAME}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].plugins.[&quot;{#PLUGIN}&quot;][?(@.id == &quot;{#ID}&quot;)].events.out.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                </discovery_rule>
                <discovery_rule>
                    <name>Logstash inputs</name>
                    <key>logstash.pipelines.stages.discovery[&quot;inputs&quot;]</key>
                    <delay>1h</delay>
                    <filter>
                        <conditions>
                            <condition>
                                <macro>{#PLUGIN}</macro>
                                <value>inputs</value>
                                <formulaid>A</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <lifetime>1d</lifetime>
                    <description>Discover stages:&#13;
inputs</description>
                    <item_prototypes>
                        <item_prototype>
                            <name>Pipeline: {#PIPELINE}, id: {#ID} events duration</name>
                            <type>DEPENDENT</type>
                            <key>logstash.inputs.events.duration[{#PIPELINE},{#PLUGIN},{#ID}]</key>
                            <delay>0</delay>
                            <units>s</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Logstash {#PLUGIN} {#NAME}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].plugins.[&quot;{#PLUGIN}&quot;][?(@.id == &quot;{#ID}&quot;)].events.queue_push_duration_in_millis.first()</params>
                                </step>
                                <step>
                                    <type>MULTIPLIER</type>
                                    <params>0.001</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>Pipeline: {#PIPELINE}, id: {#ID} events out</name>
                            <type>DEPENDENT</type>
                            <key>logstash.inputs.events.out[{#PIPELINE},{#PLUGIN},{#ID}]</key>
                            <delay>0</delay>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Logstash {#PLUGIN} {#NAME}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <params>$.pipelines.[&quot;{#PIPELINE}&quot;].plugins.[&quot;{#PLUGIN}&quot;][?(@.id == &quot;{#ID}&quot;)].events.out.first()</params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>logstash.stats</key>
                            </master_item>
                        </item_prototype>
                    </item_prototypes>
                </discovery_rule>
            </discovery_rules>
            <macros>
                <macro>
                    <macro>{$LOGSTASH.EVENTS.LAG}</macro>
                    <value>500</value>
                </macro>
                <macro>
                    <macro>{$LOGSTASH.JVM.MEMORY.WARN}</macro>
                    <value>80</value>
                </macro>
                <macro>
                    <macro>{$LOGSTASH.LA5.MAX.WARN}</macro>
                    <value>2</value>
                    <description>Load per 5 min considered sustainable. Tune if needed.</description>
                </macro>
            </macros>
        </template>
    </templates>
    <triggers>
        <trigger>
            <expression>{Template Logstash:logstash.events.in.filtered.last()}&gt;{$LOGSTASH.EVENTS.LAG} or {Template Logstash:logstash.events.in.out.last()}&gt;{$LOGSTASH.EVENTS.LAG}</expression>
            <name>Logstash events lag over {$LOGSTASH.EVENTS.LAG}</name>
            <opdata>Diff from input (filtered: {ITEM.LASTVALUE1}, out: {ITEM.LASTVALUE2})</opdata>
            <priority>WARNING</priority>
        </trigger>
        <trigger>
            <expression>{Template Logstash:logstash.heap_used_percent.last()}&gt;{$LOGSTASH.JVM.MEMORY.WARN} or ({Template Logstash:logstash.heap_used_in_bytes.last()}&gt; {Template Logstash:logstash.heap_max_in_bytes.last()})</expression>
            <name>Logstash memory usage over {$LOGSTASH.JVM.MEMORY.WARN}%</name>
            <opdata>{ITEM.LASTVALUE2} used, {ITEM.LASTVALUE3} max</opdata>
            <priority>WARNING</priority>
            <description>JVM heap memory usage to high.</description>
        </trigger>
    </triggers>
    <graphs>
        <graph>
            <name>Logstash CPU LA</name>
            <graph_items>
                <graph_item>
                    <color>199C0D</color>
                    <item>
                        <host>Template Logstash</host>
                        <key>logstash.process.cpu.load_avg.1m</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <item>
                        <host>Template Logstash</host>
                        <key>logstash.process.cpu.load_avg.5m</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>2774A4</color>
                    <item>
                        <host>Template Logstash</host>
                        <key>logstash.process.cpu.load_avg.15m</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <name>Logstash events filtered and output from input</name>
            <graph_items>
                <graph_item>
                    <drawtype>BOLD_LINE</drawtype>
                    <color>199C0D</color>
                    <item>
                        <host>Template Logstash</host>
                        <key>logstash.events.in.filtered</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <drawtype>BOLD_LINE</drawtype>
                    <color>0040FF</color>
                    <item>
                        <host>Template Logstash</host>
                        <key>logstash.events.in.out</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
    </graphs>
</zabbix_export>
